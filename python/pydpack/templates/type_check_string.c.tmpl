## int
## struct_check_string(const char *value)
#from pydpack.util import range2liststr
pcre2_code *re;
PCRE2_SPTR pattern;
int err;
int errornumber;
PCRE2_SIZE erroroffset;
pcre2_match_data *match_data;

$(assert)(value);

#for $p, $inv in $pattern
pattern = (PCRE2_SPTR)"^$p\$";
re = pcre2_compile(pattern,
                   PCRE2_ZERO_TERMINATED,
		   0,
		   &errornumber,
		   &erroroffset,
		   NULL);
if (re == NULL) {
	$(assert)(re);
	return -EAGAIN;
}

match_data = pcre2_match_data_create_from_pattern(re, NULL);
err = pcre2_match(re,
                  (PCRE2_SPTR)value,
		  strlen(value),
		  0,
		  0,
		  match_data,
		  NULL);
pcre2_code_free(re);
pcre2_match_data_free(match_data);
#if $inv
if (err == 0)
	return -EINVAL;
#else
if (err < 0)
	return -EINVAL;
#end if

#end for
#if $must
#for $f in $must
err = $(f)(value);
if (err)
	return err;

#end for
#end if
return 0;